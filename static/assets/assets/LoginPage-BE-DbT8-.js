import{r as a,a as _,u as b,j as s}from"./main-7MBCE6S9.js";import{F as y}from"./Form-D1G6LFNJ.js";import"./Input-CziDIqSD.js";const L="http://localhost:8000/api/v1";function S(){return a.useCallback(async(u,n)=>{try{const e=await fetch(`${L}/auth/jwt/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:n})});if(!e.ok){const o=await e.text();throw new Error(o||"Login failed")}const t=await e.json();return localStorage.setItem("accessToken",t.access_token),localStorage.setItem("refreshToken",t.refresh_token),{success:!0,tokens:t}}catch(e){return console.error("[useLogin] Error logging in:",e),(typeof e=="string"?e.toLowerCase():e?.message?.toLowerCase?.()||"").includes("no active account")?{success:!1,error:"Invalid email or password; please try again."}:{success:!1,error:"Login failed. Please try again."}}},[])}const j="_form_g6occ_1",k="_error_g6occ_20",x="_footer_g6occ_36",g={form:j,error:k,footer:x};function P(){const[l,u]=a.useState(""),[n,e]=a.useState(""),[t,o]=a.useState(""),[d,m]=a.useState(!1),p=S(),{login:h}=_(),f=b(),w=async r=>{r.preventDefault(),m(!0),o("");const i=await p(l,n);if(i.success)try{const c=await h(i.tokens.access_token,i.tokens.refresh_token);c.onboarding_step&&c.onboarding_step<4?f("/onboarding"):f("/game")}catch(c){o("Login succeeded but failed to fetch user info."),console.error("Post-login user fetch failed:",c)}else o(i.error||"Login failed");m(!1)};return s.jsxs(y,{title:"ðŸ” Log in",onSubmit:w,isSubmitting:d,submitLabel:"Log In",className:g.form,children:[t&&s.jsx("p",{className:g.error,children:t}),s.jsx("input",{type:"email",name:"email",placeholder:"Email",autoComplete:"email",value:l,onChange:r=>u(r.target.value),required:!0}),s.jsx("input",{type:"password",name:"password",placeholder:"Password",autoComplete:"current-password",value:n,onChange:r=>e(r.target.value),required:!0}),s.jsxs("p",{className:g.footer,children:["New here? ",s.jsx("a",{href:"/register",children:"Create an account"})]})]})}export{P as default};
