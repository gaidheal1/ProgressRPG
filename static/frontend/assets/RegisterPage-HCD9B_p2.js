import{a as j,r as e,u as R,b as E,j as r}from"./main-mIsZZiLH.js";import{F as q}from"./Form-Dd6jwBQ7.js";import"./Input-BzcLRSRp.js";const A="http://localhost:8000/api/v1";function I(){const{login:o}=j(),[d,m]=e.useState(!1);return{register:e.useCallback(async(n,f,i,c,t)=>{try{const a=await fetch(`${A}/auth/registration/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password1:f,password2:i,invite_code:c,agree_to_terms:t})}),s=await a.json();if(!a.ok)return{success:!1,errors:s,errorMessage:s?.non_field_errors?.[0]||"Registration failed."};if(s?.detail?.includes("Verification email sent"))return{success:!0,confirmationRequired:!0,message:s.detail};const{accessToken:l,refreshToken:u}=s;return l&&u?(localStorage.setItem("accessToken",l),localStorage.setItem("refreshToken",u),await o(l,u),{success:!0}):{success:!0,confirmationRequired:!0,message:"Please check your email to confirm your account.",availableCharacters:s.characters_available}}catch(a){return console.error("[useRegister] Unexpected error:",a),{success:!1,errors:null,errorMessage:"Something went wrong, please try again."}}},[o]),characterAvailable:d}}function N(){const[o,d]=e.useState(""),[m,g]=e.useState(""),[n,f]=e.useState(""),[i,c]=e.useState(""),[t,a]=e.useState({}),s=R(),{register:l,characterAvailable:u}=I(),[p,w]=e.useState(""),[v,b]=e.useState(!1),C=E(),[S,y]=e.useState("default");e.useEffect(()=>{y("default")},[C.key]);const k=async h=>{if(h.preventDefault(),c(""),a({}),m!==n){c("Passwords don't match");return}const{success:x,errors:P,errorMessage:_,confirmationRequired:T}=await l(o,m,n,p,v);x?(d(""),g(""),f(""),w(""),b(!1),T?y("submitted"):s("/game")):(c(_),a(P||{}))};return r.jsxs("div",{children:[S==="submitted"?r.jsxs("div",{children:[r.jsx("p",{children:"Thanks for registering! Please check your email and follow the confirmation link before logging in."}),!u&&r.jsx("p",{children:"We don't currently have any characters available for you to link with! Please still confirm your email, and we will let you know as soon as a character becomes available."})]}):r.jsx(q,{title:"📝 Register",fields:[{name:"email",label:"Email:",type:"email",placeholder:"Email",autoComplete:"email",value:o,onChange:d,required:!0,error:t.email?.[0]},{name:"password",label:"Password:",type:"password",placeholder:"Password",autoComplete:"new-password",value:m,onChange:g,required:!0,error:t.password1?.[0]},{name:"confirmPassword",label:"Confirm password:",type:"password",placeholder:"Confirm Password",autoComplete:"new-password",value:n,onChange:f,required:!0,error:t.password2?.[0]},{name:"invite_code",label:"Invite Code:",type:"text",placeholder:"e.g. TESTER",value:p,onChange:w,required:!0,error:t.invite_code?.[0]},{name:"agree_to_terms",label:r.jsxs(r.Fragment,{children:["I agree to the"," ",r.jsx("a",{href:"https://progressrpg.com/terms-of-service/",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",r.jsx("a",{href:"https://progressrpg.com/privacy-policy-2/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]}),type:"checkbox",checked:v,onChange:h=>b(h.target.checked),required:!0,error:t.agree_to_terms?.[0]}],error:i,onSubmit:k,submitLabel:"Create Account"}),i&&r.jsx("p",{className:"error",children:i})]})}export{N as default};
