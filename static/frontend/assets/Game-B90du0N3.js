import{j as e,e as j,r as d,B as u,f as q}from"./main-Dm1cB4_l.js";import{L as w,I as $}from"./Infobar-PB4ze0d9.js";import{B as S}from"./ButtonFrame-DkbzsbD0.js";import{I as R}from"./Input-C5T-g-KG.js";const B="_gamePage_1w0b0_1",D={gamePage:B},H="_gameSection_1bmll_1",E="_sectionHeader_1bmll_22",I="_sectionStatus_1bmll_29",L="_sectionStatusHeader_1bmll_34",M="_sectionBody_1bmll_49",_={gameSection:H,sectionHeader:E,sectionStatus:I,sectionStatusHeader:L,sectionBody:M};function N({type:t,children:s}){return e.jsxs("div",{className:`${_.gameSection} ${t}Section`,children:[e.jsx("div",{className:_.sectionHeader,children:e.jsx("div",{className:_.sectionStatus,children:e.jsx("span",{className:_.sectionStatusHeader,children:t})})}),e.jsx("div",{className:_.sectionBody,children:s})]})}const A="_row_g14gz_2",F="_activityTotals_g14gz_8",y={row:A,activityTotals:F};function C(t){const s=Math.floor(t/3600),i=Math.floor(t%3600/60),c=t%60,n=s>0?String(i).padStart(2,"0"):String(i),a=String(c).padStart(2,"0");return s>0?`${s}:${n}:${a}`:`${n}:${a}`}function P(){const{activities:t}=j(),s=t?.results?.reduce((c,n)=>c+n.duration,0)||0,i=t?.count||0;return e.jsxs("section",{className:y.listSection,children:[e.jsx("h2",{children:"Today's activities"}),e.jsx("div",{className:y.row,children:e.jsxs("div",{className:y.activityTotals,children:[e.jsx("span",{children:C(s)}),e.jsx("span",{children:"time and"}),e.jsx("span",{children:t.count}),e.jsx("span",{children:"activities logged today"})]})}),i===0?e.jsx("p",{children:"No activities completed today...so far!"}):e.jsx(w,{items:t,renderItem:c=>e.jsxs("div",{children:[c.name," – ",C(c.duration)]}),className:y.list})]})}function W(){const{activityTimer:t,questTimer:s,fetchActivities:i,fetchQuests:c,showToast:n}=j(),a=d.useRef(!1),l=d.useRef(!1);d.useEffect(()=>{const o=x=>["waiting","paused"].includes(x);o(t.status)&&o(s.status)&&!a.current&&(a.current=!0,(async()=>(o(t.status)&&await t.start(),o(s.status)&&await s.start()))())},[t.status,s.status]);const r=async()=>{a.current=!1,(m=>["active","waiting","paused"].includes(m))(t.status)&&(await t.complete(),await t.reset(),await i(),s.status!=="completed"&&s.pause())};return d.useEffect(()=>{s.status==="active"&&s.remaining===0&&!l.current&&(l.current=!0,s.complete().then(()=>c()).then(()=>t.pause()).then(()=>a.current=!1).catch(o=>{console.error("[COMBINED TIMERS] Quest completion error:",o),n("Something went wrong:",o)}).finally(()=>{l.current=!1}))},[s.remaining,s.status]),{submitActivity:r}}const G="_timerFrame_lb9ii_6",z="_timerStatus_lb9ii_14",K="_timerText_lb9ii_33",k={timerFrame:G,timerStatus:z,timerText:K};function T({label:t="Timer",time:s="00:00",status:i}){return e.jsxs("div",{className:k.timerFrame,children:[e.jsxs("div",{className:k.timerStatus,children:[t,": ",i]}),e.jsx("div",{className:k.timerText,children:s})]})}const J="_activityRow_1mvjz_13",O={activityRow:J};function V(){const[t,s]=d.useState(""),i=m=>{s(m)},{activityTimer:c}=j(),{status:n,elapsed:a,assignSubject:l}=c,r=C(a),{submitActivity:o}=W();return e.jsxs("section",{className:O.activityRow,children:[e.jsx(T,{label:"Activity",status:n,time:r}),e.jsx(R,{id:"activity-input",label:"Activity",value:t,onChange:i,placeholder:"Enter activity"}),e.jsxs(S,{children:[e.jsx(u,{onClick:()=>l(t),disabled:n!=="empty",children:"Start Activity"}),e.jsx(u,{onClick:()=>{s(""),o()},disabled:n==="empty",children:"Submit Activity"})]})]})}function X(){return e.jsxs(N,{type:"Activity",children:[e.jsx(V,{}),e.jsx(P,{})]})}const U="_questList_19xkr_1",Y={questList:U};function Z({quests:t,selectedQuest:s,onSelect:i}){const[c,n]=d.useState(null);return e.jsx("div",{className:Y.questList,children:e.jsx(w,{items:t,selectable:!0,selectedItem:s,onSelect:i,getItemKey:a=>a.id??a.name,renderItem:(a,l)=>e.jsx(e.Fragment,{children:a.name})})})}const ee="_questDetail_atj0d_2",te="_durationSelector_atj0d_26",se="_placeholder_atj0d_74",v={questDetail:ee,durationSelector:te,placeholder:se};function ne({quest:t,selectedDuration:s,onDurationChange:i,onChoose:c}){return t?e.jsxs("section",{className:v.questDetail,children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.description}),t.duration_choices&&t.duration_choices.length>0&&e.jsxs("div",{className:v.durationSelector,children:[e.jsx("label",{htmlFor:"duration-select",children:"Select duration:"}),e.jsx("select",{id:"duration-select",value:s,onChange:n=>i(Number(n.target.value)),children:t.duration_choices.map(n=>{const a=Math.floor(n/60),l=n%60,r=`${a?` ${a} min${a!==1?"s":""}`:""}${l?` ${l} sec${l!==1?"s":""}`:""}`;return e.jsx("option",{value:n,children:r},n)})})]}),e.jsx(u,{className:"primary",onClick:c,disabled:!s,children:"Select Quest"})]}):e.jsx("section",{className:v.questDetail,children:e.jsx("p",{className:v.placeholder,children:"Please select a quest from the list"})})}const ae="_modalBackdrop_1n9fj_1",ie="_modal_1n9fj_1",ce="_modalContent_1n9fj_37",oe="_modalHeader_1n9fj_57",le="_closeButton_1n9fj_65",g={modalBackdrop:ae,modal:ie,modalContent:ce,modalHeader:oe,closeButton:le};function f({title:t,children:s,onClose:i}){const c=n=>{n.target===n.currentTarget&&i?.()};return d.useEffect(()=>{const n=a=>{a.key==="Escape"&&i?.()};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[i]),e.jsx("div",{className:g.modalBackdrop,onClick:c,children:e.jsxs("div",{className:g.modal,children:[e.jsxs("header",{className:g.modalHeader,children:[e.jsx("h2",{children:t}),e.jsx(u,{onClick:i,"aria-label":"Close modal",className:g.closeButton,children:"×"})]}),e.jsx("div",{className:g.modalContent,children:s})]})})}function re({onClose:t,onChooseQuest:s}){const{quests:i}=j(),[c,n]=d.useState(null),[a,l]=d.useState(null),r=m=>{n(m),l(m.duration_choices?.[0]||null)},o=()=>{!c||!a||(s?.(c,a),t())};return e.jsxs(f,{title:"Choose your quest",onClose:t,children:[e.jsx(Z,{quests:i,selectedQuest:c,onSelect:r}),e.jsx(ne,{quest:c,selectedDuration:a,onDurationChange:l,onChoose:o})]})}function ue(){const[t,s]=d.useState("welcome"),[i,c]=d.useState(null),[n,a]=d.useState(null),l={start:"Pick the smallest possible step.",anxious:"Try a calming quest (breathing, stretching, or step outside).",tired:"Commit to 5 minutes only.",failure:"Do a deliberately bad version to fight perfectionism."},r={walkthrough:"welcome",suggestion:"walkthrough",chooseQuest:"welcome",postQuest:"welcome"};function o(x){c(x),s(null)}function m(x){a(l[x]),s("suggestion")}return e.jsxs(e.Fragment,{children:[t==="welcome"&&e.jsxs(f,{title:"Welcome back!",onClose:()=>s(null),children:[e.jsx("p",{children:"How would you like to begin?"}),e.jsxs(S,{children:[e.jsx(u,{onClick:()=>o(5),children:"Jump straight in"}),e.jsx(u,{onClick:()=>s("walkthrough"),children:"Walkthrough"})]})]}),t==="walkthrough"&&e.jsx(f,{title:"What’s most difficult right now?",onClose:()=>s(null),children:e.jsxs(S,{children:[e.jsx(u,{onClick:()=>m("start"),children:"Don’t know where to start"}),e.jsx(u,{onClick:()=>m("anxious"),children:"Feel anxious"}),e.jsx(u,{onClick:()=>m("tired"),children:"Too tired"}),e.jsx(u,{onClick:()=>m("failure"),children:"Fear of failure"})]})}),t==="suggestion"&&e.jsxs(f,{title:"Quest Suggestion",onClose:()=>s(null),children:[e.jsx("p",{children:n}),e.jsx("div",{children:[5,10,15].map(x=>e.jsxs(u,{onClick:()=>o(x),children:[x," min"]},x))}),e.jsx(u,{onClick:()=>s(r[t]),children:"Back"})]}),t==="postQuest"&&e.jsxs(f,{title:"Quest complete!",onClose:()=>s(null),children:[e.jsx("p",{className:"mt-2",children:"Nice work. What do you need next?"}),e.jsxs(S,{children:[e.jsx(u,{onClick:()=>o(i),children:"Repeat quest"}),e.jsx(u,{onClick:()=>s("walkthrough"),children:"Pick another quest"}),e.jsx(u,{onClick:()=>s(null),children:"Finish for now"})]})]})]})}const de="_container_36pq1_1",me="_header_36pq1_10",b={container:de,header:me};function he({rewards:t={},visible:s=!1}){const{xp:i=0,coins:c=0,other:n=[]}=t;if(!s)return null;const a=[{id:"xp",label:"XP",value:i},{id:"coins",label:"Coins",value:c},...n.map((r,o)=>({id:`other-${o}`,label:r}))],l=r=>"value"in r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[r.label,":"]}),e.jsx("span",{children:r.value})]}):r.label;return e.jsxs("div",{className:`${b.container} listSection`,children:[e.jsx("h2",{className:b.header,children:"Quest rewards"}),e.jsx(w,{items:a,renderItem:l})]})}const xe="_currentQuestSection_1ta1c_1",je="_questText_1ta1c_14",pe="_questLabel_1ta1c_28",_e="_currentQuestTitle_1ta1c_41",ge="_questRow_1ta1c_54",fe="_completedStage_1ta1c_60",Se="_currentStage_1ta1c_73",ye="_futureStage_1ta1c_87",h={currentQuestSection:xe,questText:je,questLabel:pe,currentQuestTitle:_e,questRow:ge,completedStage:fe,currentStage:Se,futureStage:ye};function ve(){const{questTimer:t}=j(),{subject:s,status:i,remaining:c,processedStages:n,globalStageIndex:a}=t,{name:l="None",intro_text:r="No active quest yet...",outro_text:o=""}=s||{},m=C(c),x=d.useMemo(()=>n.map((p,Q)=>({...p,isHidden:Q!==a})),[n,a]);return e.jsxs("div",{className:h.questRow,children:[e.jsx(T,{label:"Quest",status:i,time:m}),e.jsxs("div",{className:h.currentQuestSection,children:[e.jsxs("p",{className:h.questText,children:[e.jsxs("span",{className:h.questLabel,children:["Current quest:"," "]}),e.jsx("span",{className:h.currentQuestTitle,children:l})]}),e.jsx("p",{className:h.questText,children:r}),e.jsx(w,{items:x,renderItem:({stage:p})=>p?.text,getItemClassName:({globalIndex:p})=>p<a?h.completedStage:p===a?h.currentStage:h.futureStage,className:h.list,sectionClass:h.listSection}),e.jsx("p",{className:h.questText,style:{display:i=="complete"?"flex":"none"},children:o})]})]})}function Ce(){const{questTimer:t}=j(),{status:s,assignSubject:i}=t,[c,n]=d.useState(!1),[a,l]=d.useState(!1);return d.useEffect(()=>{t.isComplete&&s==="active"&&completeQuest()},[t.isComplete,s]),e.jsxs(N,{type:"Quest",children:[e.jsx(ve,{}),e.jsx(he,{rewards:{xp:0,coins:0}}),e.jsxs(S,{children:[e.jsx(u,{className:"primary",onClick:()=>{n(!0)},children:"Show quests"}),e.jsx(u,{className:"primary",onClick:()=>{l(!0)},children:"Task Support"})]}),c&&e.jsx(re,{onClose:()=>n(!1),onChooseQuest:(r,o)=>{i(r,o),n(!1)}}),a&&e.jsx(ue,{onClose:()=>l(!1),onChooseQuest:(r,o)=>{i(r,o),l(!1)}})]})}const we="_gameContent_zi8kd_1",ke={gameContent:we};function be(){return e.jsxs("div",{className:ke.gameContent,children:[e.jsx(X,{}),e.jsx(Ce,{})]})}const Ne="_gameContainer_ehewg_1",Te={gameContainer:Ne};function Qe({}){return e.jsxs("div",{className:Te.gameContainer,children:[e.jsx($,{}),e.jsx(be,{})]})}function De(){const{loading:t,error:s}=j(),{addEventHandler:i}=q();return t?e.jsx("p",{children:"Loading game data..."}):s?e.jsxs("p",{children:["Error: ",s,". Please refresh the page!"]}):e.jsx("div",{className:D.gamePage,children:e.jsx(Qe,{})})}export{De as default};
