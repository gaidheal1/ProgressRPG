import{a as j,r as e,A as R,u as E,b as A,j as a}from"./main-BWfOdQGt.js";import{F as q}from"./Form-CQefqxuy.js";import"./ButtonFrame-CQC9S0qJ.js";import"./Input-hnQxsEah.js";const I=`${R}/api/v1`;function F(){const{login:t}=j(),[d,o]=e.useState(!1);return{register:e.useCallback(async(n,m,i,c,g)=>{try{const s=await fetch(`${I}/auth/registration/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password1:m,password2:i,invite_code:c,agree_to_terms:g})}),r=await s.json();if(typeof r.characters_available=="boolean"&&o(r.characters_available),!s.ok)return{success:!1,errors:r,errorMessage:r?.non_field_errors?.[0]||"Registration failed."};if(r?.detail?.includes("Verification email sent"))return{success:!0,confirmationRequired:!0,message:r.detail};const{accessToken:l,refreshToken:u}=r;return l&&u?(localStorage.setItem("accessToken",l),localStorage.setItem("refreshToken",u),await t(l,u),{success:!0}):{success:!0,confirmationRequired:!0,message:"Please check your email to confirm your account.",availableCharacters:r.characters_available}}catch(s){return console.error("[useRegister] Unexpected error:",s),{success:!1,errors:null,errorMessage:"Something went wrong, please try again."}}},[t]),characterAvailable:d}}function O(){const[t,d]=e.useState(""),[o,f]=e.useState(""),[n,m]=e.useState(""),[i,c]=e.useState(""),[g,s]=e.useState({}),r=E(),{register:l,characterAvailable:u}=F(),[p,v]=e.useState(""),[b,w]=e.useState(!1),S=A(),[C,y]=e.useState("default");e.useEffect(()=>{y("default")},[S.key]);const k=async h=>{if(h.preventDefault(),c(""),s({}),o!==n){c("Passwords don't match");return}const{success:P,errors:x,errorMessage:_,confirmationRequired:T}=await l(t,o,n,p,b);P?(d(""),f(""),m(""),v(""),w(!1),T?y("submitted"):r("/game")):(c(_),s(x||{}))};return a.jsxs("div",{children:[C==="submitted"?a.jsxs("div",{children:[a.jsx("p",{children:"Thanks for registering! Please check your email and follow the confirmation link before logging in."}),!u&&a.jsx("p",{children:"We don't currently have any characters available for you to link with! Please still confirm your email, and we will let you know as soon as a character becomes available."})]}):a.jsx(q,{title:"📝 Register",fields:[{name:"email",label:"Email:",type:"email",placeholder:"Email",autoComplete:"email",value:t,onChange:d,required:!0},{name:"password",label:"Password:",type:"password",placeholder:"Password",autoComplete:"new-password",value:o,onChange:f,required:!0},{name:"confirmPassword",label:"Confirm password:",type:"password",placeholder:"Confirm Password",autoComplete:"new-password",value:n,onChange:m,required:!0},{name:"invite_code",label:"Invite Code:",type:"text",placeholder:"e.g. TESTER",value:p,onChange:v,required:!0},{name:"agree_to_terms",label:a.jsxs(a.Fragment,{children:["I agree to the"," ",a.jsx("a",{href:"https://progressrpg.com/terms-of-service/",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"https://progressrpg.com/privacy-policy-2/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]}),type:"checkbox",checked:b,onChange:h=>w(h.target.checked),required:!0}],error:i,onSubmit:k,submitLabel:"Create Account"}),i&&a.jsx("p",{className:"error",children:i})]})}export{O as default};
