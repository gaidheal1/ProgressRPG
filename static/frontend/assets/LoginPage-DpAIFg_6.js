import{r as a,A as d,a as L,u as S,j as s}from"./main-czsaRuJ1.js";import{F as b}from"./Form-BNvjEyKw.js";import"./Input-vG2l26YZ.js";console.log("API_BASE_URL:",d);const y=`${d}/api/v1`;function j(){return a.useCallback(async(u,n)=>{try{const e=await fetch(`${y}/auth/jwt/create/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,password:n})});if(!e.ok){const o=await e.text();throw new Error(o||"Login failed")}const t=await e.json();return localStorage.setItem("accessToken",t.access_token),localStorage.setItem("refreshToken",t.refresh_token),{success:!0,tokens:t}}catch(e){return console.error("[useLogin] Error logging in:",e),(typeof e=="string"?e.toLowerCase():e?.message?.toLowerCase?.()||"").includes("no active account")?{success:!1,error:"Invalid email or password; please try again."}:{success:!1,error:"Login failed. Please try again."}}},[])}const k="_form_g6occ_1",x="_error_g6occ_20",v="_footer_g6occ_36",g={form:k,error:x,footer:v};function A(){const[l,u]=a.useState(""),[n,e]=a.useState(""),[t,o]=a.useState(""),[p,m]=a.useState(!1),h=j(),{login:_}=L(),f=S(),w=async r=>{r.preventDefault(),m(!0),o("");const i=await h(l,n);if(i.success)try{const c=await _(i.tokens.access_token,i.tokens.refresh_token);c.onboarding_step&&c.onboarding_step<4?f("/onboarding"):f("/game")}catch(c){o("Login succeeded but failed to fetch user info."),console.error("Post-login user fetch failed:",c)}else o(i.error||"Login failed");m(!1)};return s.jsxs(b,{title:"🔐 Log in",onSubmit:w,isSubmitting:p,submitLabel:"Log In",className:g.form,children:[t&&s.jsx("p",{className:g.error,children:t}),s.jsx("input",{type:"email",name:"email",placeholder:"Email",autoComplete:"email",value:l,onChange:r=>u(r.target.value),required:!0}),s.jsx("input",{type:"password",name:"password",placeholder:"Password",autoComplete:"current-password",value:n,onChange:r=>e(r.target.value),required:!0}),s.jsxs("p",{className:g.footer,children:["New here? ",s.jsx("a",{href:"/register",children:"Create an account"})]})]})}export{A as default};
