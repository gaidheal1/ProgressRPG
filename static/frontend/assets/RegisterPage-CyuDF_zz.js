import{a as j,r as e,A as R,u as E,b as A,j as a}from"./main-Tnvl3Ojr.js";import{F as q}from"./Form-DicZNYAU.js";import"./Input-C3aXe5FU.js";const I=`${R}/api/v1`;function F(){const{login:o}=j(),[m,n]=e.useState(!1);return{register:e.useCallback(async(i,f,c,l,s)=>{try{const t=await fetch(`${I}/auth/registration/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password1:f,password2:c,invite_code:l,agree_to_terms:s})}),r=await t.json();if(typeof r.characters_available=="boolean"&&n(r.characters_available),!t.ok)return{success:!1,errors:r,errorMessage:r?.non_field_errors?.[0]||"Registration failed."};if(r?.detail?.includes("Verification email sent"))return{success:!0,confirmationRequired:!0,message:r.detail};const{accessToken:u,refreshToken:d}=r;return u&&d?(localStorage.setItem("accessToken",u),localStorage.setItem("refreshToken",d),await o(u,d),{success:!0}):{success:!0,confirmationRequired:!0,message:"Please check your email to confirm your account.",availableCharacters:r.characters_available}}catch(t){return console.error("[useRegister] Unexpected error:",t),{success:!1,errors:null,errorMessage:"Something went wrong, please try again."}}},[o]),characterAvailable:m}}function U(){const[o,m]=e.useState(""),[n,g]=e.useState(""),[i,f]=e.useState(""),[c,l]=e.useState(""),[s,t]=e.useState({}),r=E(),{register:u,characterAvailable:d}=F(),[p,v]=e.useState(""),[w,b]=e.useState(!1),S=A(),[C,y]=e.useState("default");e.useEffect(()=>{y("default")},[S.key]);const _=async h=>{if(h.preventDefault(),l(""),t({}),n!==i){l("Passwords don't match");return}const{success:k,errors:P,errorMessage:x,confirmationRequired:T}=await u(o,n,i,p,w);k?(m(""),g(""),f(""),v(""),b(!1),T?y("submitted"):r("/game")):(l(x),t(P||{}))};return a.jsxs("div",{children:[C==="submitted"?a.jsxs("div",{children:[a.jsx("p",{children:"Thanks for registering! Please check your email and follow the confirmation link before logging in."}),!d&&a.jsx("p",{children:"We don't currently have any characters available for you to link with! Please still confirm your email, and we will let you know as soon as a character becomes available."})]}):a.jsx(q,{title:"📝 Register",fields:[{name:"email",label:"Email:",type:"email",placeholder:"Email",autoComplete:"email",value:o,onChange:m,required:!0,error:s.email?.[0]},{name:"password",label:"Password:",type:"password",placeholder:"Password",autoComplete:"new-password",value:n,onChange:g,required:!0,error:s.password1?.[0]},{name:"confirmPassword",label:"Confirm password:",type:"password",placeholder:"Confirm Password",autoComplete:"new-password",value:i,onChange:f,required:!0,error:s.password2?.[0]},{name:"invite_code",label:"Invite Code:",type:"text",placeholder:"e.g. TESTER",value:p,onChange:v,required:!0,error:s.invite_code?.[0]},{name:"agree_to_terms",label:a.jsxs(a.Fragment,{children:["I agree to the"," ",a.jsx("a",{href:"https://progressrpg.com/terms-of-service/",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"https://progressrpg.com/privacy-policy-2/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]}),type:"checkbox",checked:w,onChange:h=>b(h.target.checked),required:!0,error:s.agree_to_terms?.[0]}],error:c,onSubmit:_,submitLabel:"Create Account"}),c&&a.jsx("p",{className:"error",children:c})]})}export{U as default};
