import{j as e,e as h,r as d,B as p,f as Q}from"./main-DGDoed-U.js";import{L as v,I as $}from"./Infobar-BLRtjC1W.js";import{B as C}from"./ButtonFrame-jvD8e5Qj.js";import{I as R}from"./Input-Bx1fC8Wd.js";const B="_gamePage_1w0b0_1",H={gamePage:B},I="_gameSection_1bmll_1",k="_sectionHeader_1bmll_22",A="_sectionStatus_1bmll_29",D="_sectionStatusHeader_1bmll_34",L="_sectionBody_1bmll_49",x={gameSection:I,sectionHeader:k,sectionStatus:A,sectionStatusHeader:D,sectionBody:L};function T({type:t,children:s}){return e.jsxs("div",{className:`${x.gameSection} ${t}Section`,children:[e.jsx("div",{className:x.sectionHeader,children:e.jsx("div",{className:x.sectionStatus,children:e.jsx("span",{className:x.sectionStatusHeader,children:t})})}),e.jsx("div",{className:x.sectionBody,children:s})]})}const E="_row_g14gz_2",M="_activityTotals_g14gz_8",f={row:E,activityTotals:M};function g(t){const s=Math.floor(t/3600),c=Math.floor(t%3600/60),i=t%60,a=s>0?String(c).padStart(2,"0"):String(c),n=String(i).padStart(2,"0");return s>0?`${s}:${a}:${n}`:`${a}:${n}`}function F(){const{activities:t}=h(),s=t?.results?.reduce((i,a)=>i+a.duration,0)||0,c=t?.count||0;return e.jsxs("section",{className:f.listSection,children:[e.jsx("h2",{children:"Today's activities"}),e.jsx("div",{className:f.row,children:e.jsxs("div",{className:f.activityTotals,children:[e.jsx("span",{children:g(s)}),e.jsx("span",{children:"time and"}),e.jsx("span",{children:t.count}),e.jsx("span",{children:"activities logged today"})]})}),c===0?e.jsx("p",{children:"No activities completed today...so far!"}):e.jsx(v,{items:t,renderItem:i=>e.jsxs("div",{children:[i.name," – ",g(i.duration)]}),className:f.list})]})}function P(){const{activityTimer:t,questTimer:s,fetchActivities:c,fetchQuests:i,showToast:a}=h(),n=d.useRef(!1),o=d.useRef(!1);d.useEffect(()=>{const l=y=>["waiting","paused"].includes(y);l(t.status)&&l(s.status)&&!n.current&&(n.current=!0,(async()=>(l(t.status)&&await t.start(),l(s.status)&&await s.start()))())},[t.status,s.status]);const r=async()=>{n.current=!1,(m=>["active","waiting","paused"].includes(m))(t.status)&&(await t.complete(),await t.reset(),await c(),s.status!=="completed"&&s.pause())};return d.useEffect(()=>{s.status==="active"&&s.remaining===0&&!o.current&&(o.current=!0,s.complete().then(()=>i()).then(()=>t.pause()).then(()=>n.current=!1).catch(l=>{console.error("[COMBINED TIMERS] Quest completion error:",l),a("Something went wrong:",l)}).finally(()=>{o.current=!1}))},[s.remaining,s.status]),{submitActivity:r}}const G="_timerFrame_lb9ii_6",z="_timerStatus_lb9ii_14",O="_timerText_lb9ii_33",N={timerFrame:G,timerStatus:z,timerText:O};function q({label:t="Timer",time:s="00:00",status:c}){return e.jsxs("div",{className:N.timerFrame,children:[e.jsxs("div",{className:N.timerStatus,children:[t,": ",c]}),e.jsx("div",{className:N.timerText,children:s})]})}const K="_activityRow_1mvjz_13",V={activityRow:K};function W(){const[t,s]=d.useState(""),c=m=>{s(m)},{activityTimer:i}=h(),{status:a,elapsed:n,assignSubject:o}=i,r=g(n),{submitActivity:l}=P();return e.jsxs("section",{className:V.activityRow,children:[e.jsx(q,{label:"Activity",status:a,time:r}),e.jsx(R,{id:"activity-input",label:"Activity",value:t,onChange:c,placeholder:"Enter activity"}),e.jsxs(C,{children:[e.jsx(p,{onClick:()=>o(t),disabled:a!=="empty",children:"Start Activity"}),e.jsx(p,{onClick:()=>{s(""),l()},disabled:a==="empty",children:"Submit Activity"})]})]})}function X(){return e.jsxs(T,{type:"Activity",children:[e.jsx(W,{}),e.jsx(F,{})]})}const J="_questList_19xkr_1",U={questList:J};function Y({quests:t,selectedQuest:s,onSelect:c}){const[i,a]=d.useState(null);return e.jsx("div",{className:U.questList,children:e.jsx(v,{items:t,selectable:!0,selectedItem:s,onSelect:c,getItemKey:n=>n.id??n.name,renderItem:(n,o)=>e.jsx(e.Fragment,{children:n.name})})})}const Z="_questDetail_atj0d_2",ee="_durationSelector_atj0d_26",te="_placeholder_atj0d_74",S={questDetail:Z,durationSelector:ee,placeholder:te};function se({quest:t,selectedDuration:s,onDurationChange:c,onChoose:i}){return t?e.jsxs("section",{className:S.questDetail,children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.description}),t.duration_choices&&t.duration_choices.length>0&&e.jsxs("div",{className:S.durationSelector,children:[e.jsx("label",{htmlFor:"duration-select",children:"Select duration:"}),e.jsx("select",{id:"duration-select",value:s,onChange:a=>c(Number(a.target.value)),children:t.duration_choices.map(a=>{const n=Math.floor(a/60),o=a%60,r=`${n?` ${n} min${n!==1?"s":""}`:""}${o?` ${o} sec${o!==1?"s":""}`:""}`;return e.jsx("option",{value:a,children:r},a)})})]}),e.jsx(p,{className:"primary",onClick:i,disabled:!s,children:"Select Quest"})]}):e.jsx("section",{className:S.questDetail,children:e.jsx("p",{className:S.placeholder,children:"Please select a quest from the list"})})}const ne="_modalBackdrop_1n9fj_1",ae="_modal_1n9fj_1",ce="_modalContent_1n9fj_37",ie="_modalHeader_1n9fj_57",oe="_closeButton_1n9fj_65",j={modalBackdrop:ne,modal:ae,modalContent:ce,modalHeader:ie,closeButton:oe};function re({onClose:t,onChooseQuest:s}){const{quests:c}=h(),[i,a]=d.useState(null),[n,o]=d.useState(null),r=m=>{a(m),o(m.duration_choices?.[0]||null)},l=()=>{!i||!n||(s?.(i,n),t())};return e.jsx("div",{className:j.modalBackdrop,children:e.jsxs("div",{className:j.modal,children:[e.jsxs("header",{className:j.modalHeader,children:[e.jsx("h2",{children:"Choose your quest"}),e.jsx(p,{onClick:t,"aria-label":"Close modal",className:j.closeButton,children:"×"})]}),e.jsxs("div",{className:j.modalContent,children:[e.jsx(Y,{quests:c,selectedQuest:i,onSelect:r}),e.jsx(se,{quest:i,selectedDuration:n,onDurationChange:o,onChoose:l})]})]})})}const le="_container_36pq1_1",ue="_header_36pq1_10",b={container:le,header:ue};function de({rewards:t={},visible:s=!1}){const{xp:c=0,coins:i=0,other:a=[]}=t;if(!s)return null;const n=[{id:"xp",label:"XP",value:c},{id:"coins",label:"Coins",value:i},...a.map((r,l)=>({id:`other-${l}`,label:r}))],o=r=>"value"in r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[r.label,":"]}),e.jsx("span",{children:r.value})]}):r.label;return e.jsxs("div",{className:`${b.container} listSection`,children:[e.jsx("h2",{className:b.header,children:"Quest rewards"}),e.jsx(v,{items:n,renderItem:o})]})}const me="_currentQuestSection_1ta1c_1",he="_questText_1ta1c_14",_e="_questLabel_1ta1c_28",xe="_currentQuestTitle_1ta1c_41",je="_questRow_1ta1c_54",pe="_completedStage_1ta1c_60",fe="_currentStage_1ta1c_73",Se="_futureStage_1ta1c_87",u={currentQuestSection:me,questText:he,questLabel:_e,currentQuestTitle:xe,questRow:je,completedStage:pe,currentStage:fe,futureStage:Se};function ge(){const{questTimer:t}=h(),{subject:s,status:c,remaining:i,processedStages:a,globalStageIndex:n}=t,{name:o="None",intro_text:r="No active quest yet...",outro_text:l=""}=s||{},m=g(i),y=d.useMemo(()=>a.map((_,w)=>({..._,isHidden:w!==n})),[a,n]);return e.jsxs("div",{className:u.questRow,children:[e.jsx(q,{label:"Quest",status:c,time:m}),e.jsxs("div",{className:u.currentQuestSection,children:[e.jsxs("p",{className:u.questText,children:[e.jsxs("span",{className:u.questLabel,children:["Current quest:"," "]}),e.jsx("span",{className:u.currentQuestTitle,children:o})]}),e.jsx("p",{className:u.questText,children:r}),e.jsx(v,{items:y,renderItem:({stage:_})=>_?.text,getItemClassName:({globalIndex:_})=>_<n?u.completedStage:_===n?u.currentStage:u.futureStage,className:u.list,sectionClass:u.listSection}),e.jsx("p",{className:u.questText,style:{display:c=="complete"?"flex":"none"},children:l})]})]})}function ve(){const{questTimer:t}=h(),{status:s,assignSubject:c}=t,[i,a]=d.useState(!1);return d.useEffect(()=>{t.isComplete&&s==="active"&&completeQuest()},[t.isComplete,s]),e.jsxs(T,{type:"Quest",children:[e.jsx(ge,{}),e.jsx(de,{rewards:{xp:0,coins:0}}),e.jsx(C,{children:e.jsx(p,{className:"primary",onClick:()=>{a(!0)},children:"Show quests"})}),i&&e.jsx(re,{onClose:()=>a(!1),onChooseQuest:(n,o)=>{c(n,o),a(!1)}})]})}const ye="_gameContent_zi8kd_1",Ne={gameContent:ye};function be(){return e.jsxs("div",{className:Ne.gameContent,children:[e.jsx(X,{}),e.jsx(ve,{})]})}const Ce="_gameContainer_ehewg_1",Te={gameContainer:Ce};function qe({}){return e.jsxs("div",{className:Te.gameContainer,children:[e.jsx($,{}),e.jsx(be,{})]})}function Be(){const{loading:t,error:s}=h(),{addEventHandler:c}=Q();return t?e.jsx("p",{children:"Loading game data..."}):s?e.jsxs("p",{children:["Error: ",s,". Please refresh the page!"]}):e.jsx("div",{className:H.gamePage,children:e.jsx(qe,{})})}export{Be as default};
