import{a as j,r as e,A as R,u as E,b as A,j as r}from"./main-jWyFHlDI.js";import{F as q}from"./Form-D2w_svA0.js";import"./Input-BXxu2Y3B.js";const I=`${R}/api/v1`;function F(){const{login:o}=j(),[d,m]=e.useState(!1);return{register:e.useCallback(async(n,f,i,c,a)=>{try{const t=await fetch(`${I}/auth/registration/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password1:f,password2:i,invite_code:c,agree_to_terms:a})}),s=await t.json();if(!t.ok)return{success:!1,errors:s,errorMessage:s?.non_field_errors?.[0]||"Registration failed."};if(s?.detail?.includes("Verification email sent"))return{success:!0,confirmationRequired:!0,message:s.detail};const{accessToken:l,refreshToken:u}=s;return l&&u?(localStorage.setItem("accessToken",l),localStorage.setItem("refreshToken",u),await o(l,u),{success:!0}):{success:!0,confirmationRequired:!0,message:"Please check your email to confirm your account.",availableCharacters:s.characters_available}}catch(t){return console.error("[useRegister] Unexpected error:",t),{success:!1,errors:null,errorMessage:"Something went wrong, please try again."}}},[o]),characterAvailable:d}}function U(){const[o,d]=e.useState(""),[m,g]=e.useState(""),[n,f]=e.useState(""),[i,c]=e.useState(""),[a,t]=e.useState({}),s=E(),{register:l,characterAvailable:u}=F(),[p,w]=e.useState(""),[v,b]=e.useState(!1),S=A(),[C,y]=e.useState("default");e.useEffect(()=>{y("default")},[S.key]);const k=async h=>{if(h.preventDefault(),c(""),t({}),m!==n){c("Passwords don't match");return}const{success:P,errors:_,errorMessage:x,confirmationRequired:T}=await l(o,m,n,p,v);P?(d(""),g(""),f(""),w(""),b(!1),T?y("submitted"):s("/game")):(c(x),t(_||{}))};return r.jsxs("div",{children:[C==="submitted"?r.jsxs("div",{children:[r.jsx("p",{children:"Thanks for registering! Please check your email and follow the confirmation link before logging in."}),!u&&r.jsx("p",{children:"We don't currently have any characters available for you to link with! Please still confirm your email, and we will let you know as soon as a character becomes available."})]}):r.jsx(q,{title:"📝 Register",fields:[{name:"email",label:"Email:",type:"email",placeholder:"Email",autoComplete:"email",value:o,onChange:d,required:!0,error:a.email?.[0]},{name:"password",label:"Password:",type:"password",placeholder:"Password",autoComplete:"new-password",value:m,onChange:g,required:!0,error:a.password1?.[0]},{name:"confirmPassword",label:"Confirm password:",type:"password",placeholder:"Confirm Password",autoComplete:"new-password",value:n,onChange:f,required:!0,error:a.password2?.[0]},{name:"invite_code",label:"Invite Code:",type:"text",placeholder:"e.g. TESTER",value:p,onChange:w,required:!0,error:a.invite_code?.[0]},{name:"agree_to_terms",label:r.jsxs(r.Fragment,{children:["I agree to the"," ",r.jsx("a",{href:"https://progressrpg.com/terms-of-service/",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," ","and"," ",r.jsx("a",{href:"https://progressrpg.com/privacy-policy-2/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]}),type:"checkbox",checked:v,onChange:h=>b(h.target.checked),required:!0,error:a.agree_to_terms?.[0]}],error:i,onSubmit:k,submitLabel:"Create Account"}),i&&r.jsx("p",{className:"error",children:i})]})}export{U as default};
