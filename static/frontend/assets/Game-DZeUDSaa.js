import{f as T,r as d,j as e,e as h,B as p}from"./main-mPDHaF4T.js";import{L as g,I as $}from"./Infobar-S8AZjxzk.js";import{I as R,B as C}from"./Input-mlvUgbMo.js";function k(t){const{addEventHandler:s}=T();d.useEffect(()=>{if(!t)return;const c=s(t);return()=>c()},[t,s])}const B="_gamePage_1w0b0_1",H={gamePage:B},E="_gameSection_1bmll_1",I="_sectionHeader_1bmll_22",A="_sectionStatus_1bmll_29",D="_sectionStatusHeader_1bmll_34",L="_sectionBody_1bmll_49",x={gameSection:E,sectionHeader:I,sectionStatus:A,sectionStatusHeader:D,sectionBody:L};function w({type:t,children:s}){return e.jsxs("div",{className:`${x.gameSection} ${t}Section`,children:[e.jsx("div",{className:x.sectionHeader,children:e.jsx("div",{className:x.sectionStatus,children:e.jsx("span",{className:x.sectionStatusHeader,children:t})})}),e.jsx("div",{className:x.sectionBody,children:s})]})}const M="_row_g14gz_2",F="_activityTotals_g14gz_8",f={row:M,activityTotals:F};function v(t){const s=Math.floor(t/3600),c=Math.floor(t%3600/60),i=t%60,a=s>0?String(c).padStart(2,"0"):String(c),n=String(i).padStart(2,"0");return s>0?`${s}:${a}:${n}`:`${a}:${n}`}function P(){const{activities:t}=h(),s=t?.results?.reduce((i,a)=>i+a.duration,0)||0,c=t?.count||0;return e.jsxs("section",{className:f.listSection,children:[e.jsx("h2",{children:"Today's activities"}),e.jsx("div",{className:f.row,children:e.jsxs("div",{className:f.activityTotals,children:[e.jsx("span",{children:v(s)}),e.jsx("span",{children:"time and"}),e.jsx("span",{children:t.count}),e.jsx("span",{children:"activities logged today"})]})}),c===0?e.jsx("p",{children:"No activities completed today...so far!"}):e.jsx(g,{items:t,renderItem:i=>e.jsxs("div",{children:[i.name," – ",v(i.duration)]}),className:f.list})]})}function W(){const{activityTimer:t,questTimer:s,fetchActivities:c,fetchQuests:i,showToast:a}=h(),n=d.useRef(!1),o=d.useRef(!1);d.useEffect(()=>{const l=y=>["waiting","paused"].includes(y);l(t.status)&&l(s.status)&&!n.current&&(n.current=!0,(async()=>(l(t.status)&&await t.start(),l(s.status)&&await s.start()))())},[t.status,s.status]);const r=async()=>{n.current=!1,(m=>["active","waiting","paused"].includes(m))(t.status)&&(await t.complete(),await t.reset(),await c(),s.status!=="completed"&&s.pause())};return d.useEffect(()=>{s.status==="active"&&s.remaining===0&&!o.current&&(o.current=!0,s.complete().then(()=>i()).then(()=>t.pause()).then(()=>n.current=!1).catch(l=>{console.error("[COMBINED TIMERS] Quest completion error:",l),a("Something went wrong:",l)}).finally(()=>{o.current=!1}))},[s.remaining,s.status]),{submitActivity:r}}const G="_timerFrame_lb9ii_6",z="_timerStatus_lb9ii_14",O="_timerText_lb9ii_33",b={timerFrame:G,timerStatus:z,timerText:O};function q({label:t="Timer",time:s="00:00",status:c}){return e.jsxs("div",{className:b.timerFrame,children:[e.jsxs("div",{className:b.timerStatus,children:[t,": ",c]}),e.jsx("div",{className:b.timerText,children:s})]})}const K="_activityRow_1mvjz_13",U={activityRow:K};function V(){const[t,s]=d.useState(""),c=m=>{s(m)},{activityTimer:i}=h(),{status:a,elapsed:n,assignSubject:o}=i,r=v(n),{submitActivity:l}=W();return e.jsxs("section",{className:U.activityRow,children:[e.jsx(q,{label:"Activity",status:a,time:r}),e.jsx(R,{id:"activity-input",label:"Activity",value:t,onChange:c,placeholder:"Enter activity"}),e.jsxs(C,{children:[e.jsx(p,{onClick:()=>o(t),disabled:a!=="empty",children:"Start Activity"}),e.jsx(p,{onClick:()=>{s(""),l()},disabled:a==="empty",children:"Submit Activity"})]})]})}function X(){return e.jsxs(w,{type:"Activity",children:[e.jsx(V,{}),e.jsx(P,{})]})}const J="_questList_19xkr_1",Y={questList:J};function Z({quests:t,selectedQuest:s,onSelect:c}){const[i,a]=d.useState(null);return e.jsx("div",{className:Y.questList,children:e.jsx(g,{items:t,selectable:!0,selectedItem:s,onSelect:c,getItemKey:n=>n.id??n.name,renderItem:(n,o)=>e.jsx(e.Fragment,{children:n.name})})})}const ee="_questDetail_atj0d_2",te="_durationSelector_atj0d_26",se="_placeholder_atj0d_74",S={questDetail:ee,durationSelector:te,placeholder:se};function ne({quest:t,selectedDuration:s,onDurationChange:c,onChoose:i}){return t?e.jsxs("section",{className:S.questDetail,children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.description}),t.duration_choices&&t.duration_choices.length>0&&e.jsxs("div",{className:S.durationSelector,children:[e.jsx("label",{htmlFor:"duration-select",children:"Select duration:"}),e.jsx("select",{id:"duration-select",value:s,onChange:a=>c(Number(a.target.value)),children:t.duration_choices.map(a=>{const n=Math.floor(a/60),o=a%60,r=`${n?` ${n} min${n!==1?"s":""}`:""}${o?` ${o} sec${o!==1?"s":""}`:""}`;return e.jsx("option",{value:a,children:r},a)})})]}),e.jsx(p,{className:"primary",onClick:i,disabled:!s,children:"Select Quest"})]}):e.jsx("section",{className:S.questDetail,children:e.jsx("p",{className:S.placeholder,children:"Please select a quest from the list"})})}const ae="_modalBackdrop_1n9fj_1",ce="_modal_1n9fj_1",ie="_modalContent_1n9fj_37",oe="_modalHeader_1n9fj_57",re="_closeButton_1n9fj_65",j={modalBackdrop:ae,modal:ce,modalContent:ie,modalHeader:oe,closeButton:re};function le({onClose:t,onChooseQuest:s}){const{quests:c}=h(),[i,a]=d.useState(null),[n,o]=d.useState(null),r=m=>{a(m),o(m.duration_choices?.[0]||null)},l=()=>{!i||!n||(s?.(i,n),t())};return e.jsx("div",{className:j.modalBackdrop,children:e.jsxs("div",{className:j.modal,children:[e.jsxs("header",{className:j.modalHeader,children:[e.jsx("h2",{children:"Choose your quest"}),e.jsx(p,{onClick:t,"aria-label":"Close modal",className:j.closeButton,children:"×"})]}),e.jsxs("div",{className:j.modalContent,children:[e.jsx(Z,{quests:c,selectedQuest:i,onSelect:r}),e.jsx(ne,{quest:i,selectedDuration:n,onDurationChange:o,onChoose:l})]})]})})}const ue="_container_36pq1_1",de="_header_36pq1_10",N={container:ue,header:de};function me({rewards:t={},visible:s=!1}){const{xp:c=0,coins:i=0,other:a=[]}=t;if(!s)return null;const n=[{id:"xp",label:"XP",value:c},{id:"coins",label:"Coins",value:i},...a.map((r,l)=>({id:`other-${l}`,label:r}))],o=r=>"value"in r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[r.label,":"]}),e.jsx("span",{children:r.value})]}):r.label;return e.jsxs("div",{className:`${N.container} listSection`,children:[e.jsx("h2",{className:N.header,children:"Quest rewards"}),e.jsx(g,{items:n,renderItem:o})]})}const he="_currentQuestSection_1ta1c_1",_e="_questText_1ta1c_14",xe="_questLabel_1ta1c_28",je="_currentQuestTitle_1ta1c_41",pe="_questRow_1ta1c_54",fe="_completedStage_1ta1c_60",Se="_currentStage_1ta1c_73",ve="_futureStage_1ta1c_87",u={currentQuestSection:he,questText:_e,questLabel:xe,currentQuestTitle:je,questRow:pe,completedStage:fe,currentStage:Se,futureStage:ve};function ge(){const{questTimer:t}=h(),{subject:s,status:c,remaining:i,processedStages:a,globalStageIndex:n}=t,{name:o="None",intro_text:r="No active quest yet...",outro_text:l=""}=s||{},m=v(i),y=d.useMemo(()=>a.map((_,Q)=>({..._,isHidden:Q!==n})),[a,n]);return e.jsxs("div",{className:u.questRow,children:[e.jsx(q,{label:"Quest",status:c,time:m}),e.jsxs("div",{className:u.currentQuestSection,children:[e.jsxs("p",{className:u.questText,children:[e.jsxs("span",{className:u.questLabel,children:["Current quest:"," "]}),e.jsx("span",{className:u.currentQuestTitle,children:o})]}),e.jsx("p",{className:u.questText,children:r}),e.jsx(g,{items:y,renderItem:({stage:_})=>_?.text,getItemClassName:({globalIndex:_})=>_<n?u.completedStage:_===n?u.currentStage:u.futureStage,className:u.list,sectionClass:u.listSection}),e.jsx("p",{className:u.questText,style:{display:c=="complete"?"flex":"none"},children:l})]})]})}function ye(){const{questTimer:t}=h(),{status:s,assignSubject:c}=t,[i,a]=d.useState(!1);return d.useEffect(()=>{t.isComplete&&s==="active"&&completeQuest()},[t.isComplete,s]),e.jsxs(w,{type:"Quest",children:[e.jsx(ge,{}),e.jsx(me,{rewards:{xp:0,coins:0}}),e.jsx(C,{children:e.jsx(p,{className:"primary",onClick:()=>{a(!0)},children:"Show quests"})}),i&&e.jsx(le,{onClose:()=>a(!1),onChooseQuest:(n,o)=>{c(n,o),a(!1)}})]})}const be="_gameContent_zi8kd_1",Ne={gameContent:be};function Te(){return e.jsxs("div",{className:Ne.gameContent,children:[e.jsx(X,{}),e.jsx(ye,{})]})}const Ce="_gameContainer_ehewg_1",we={gameContainer:Ce};function qe({}){return e.jsxs("div",{className:we.gameContainer,children:[e.jsx($,{}),e.jsx(Te,{})]})}function Qe(t,{showToast:s,activityTimer:c,questTimer:i}){if(t.type==="action")switch(t.action){case"start_timers":break;case"pause_timers":break;case"submit_activity":console.log("Server WS sent 'submit_activity'");break;case"quest_complete":console.log("Server WS sent 'complete_quest'");break;default:console.warn("[WS] Unknown action:",t)}}function Be(){const{player:t,activityTimer:s,questTimer:c,loading:i,showToast:a,error:n}=h(),{addEventHandler:o}=T();return k(r=>{Qe(r,{showToast:a,activityTimer:s,questTimer:c})}),i?e.jsx("p",{children:"Loading game data..."}):n?e.jsxs("p",{children:["Error: ",n,". Please refresh the page!"]}):e.jsx("div",{className:H.gamePage,children:e.jsx(qe,{})})}export{Be as default};
